## With SPDM vs Without SPDM

The benchmarking scripts have to be run twice: one time to assess performance with SPDM enabled, and a second time to get baseline results without SPDM.

Currently, enabling/disabling SPDM requires recompiling the Kernel. This is done by changing `SPDM_ENABLED` flag in `virtio_blk.c`.

## HD benchmarking scripts

### hdbenchmark.sh:

This script runs the benchmarks saving the output as hdbenchmark\_[date]\_[command].out, in which date is in the format YYYYmmDDHHMM

Variables at the top of the script define some parameters. Double check those.

Make sure the target directory is mounted before starting.

### parse_hdbenchmark.py

Processes hdbenchmark.sh output into csv files

Usage: `python3 parse_hdbenchmark.py YYYYmmDDHHMM`, where YYYYmmDDHHMM is the timestamp generated by `hdbenchmark.sh`

The output file is named `hdbenchmark_YYYYmmDDHHMM_summary.csv`

### getting boot times

Add [S99boottime](S99boottime) to /etc/init.d in the VM. Give it execution permission (`chmod +x S99boottime`)

Boot times are saved at `/root/boottimes.log`. The VM needs to be rebooted manually until the desired amount of data is collected.

The results have to be manually added to `hdbenchmark_YYYYmmDDHHMM_summary.csv`. A way to do it:

```shell
grep -v SPDM <file with boottimes> | LC_NUMERIC=en_US.UTF-8 awk '{total += $1; totalsq += $1*$1; count++ } END { print "boot time;"total/count";"(totalsq-total*total/count)/(count-1) }' >> hdbenchmark_YYYYmmDDHHMM_summary.csv
```

## Plotting results plot_hdbenchmark.py

Plots graphs from csv files generated by parse_hdbenchmark.py

Usage: `python3 plot_hdbenchmark.py csv_file1 label1 csv_file2 label2 ...`, where the label represents the label to be displayed in the graph's legend

Typical usage is `python3 plot_hdbenchmark.py hdbenchmark_202201301000_summary.csv "With SPDM" hdbenchmark_202201311100_summary.csv "No SPDM`
